<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>CMD - Gửi vị trí</title>
  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: monospace;
      padding: 20px;
    }
    input {
      width: 100%;
      font-size: 16px;
      background: #000;
      color: #0f0;
      border: none;
      border-bottom: 1px solid #0f0;
      outline: none;
    }
    .output { margin-top: 10px; }
  </style>
</head>
<body>
  <div>> Nhập lệnh:</div>
  <input type="text" id="cmdInput" placeholder="VD: tôi muốn show vị trí bản thân">
  <div class="output" id="outputArea"></div>

  <script>
    const cmdInput = document.getElementById("cmdInput");
    const outputArea = document.getElementById("outputArea");

    cmdInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        const command = cmdInput.value.trim().toLowerCase();
        outputArea.innerHTML += `<div>> ${command}</div>`;
        cmdInput.value = "";

        if (command === "tôi muốn show vị trí bản thân") {
          if (navigator.geolocation) {
            outputArea.innerHTML += "<div>Đang lấy vị trí...</div>";

            navigator.geolocation.getCurrentPosition((pos) => {
              const lat = pos.coords.latitude;
              const lon = pos.coords.longitude;

              fetch('/api/location', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ latitude: lat, longitude: lon })
              })
              .then(res => res.json())
              .then(data => {
                if (data.success) {
                  outputArea.innerHTML += "<div>✅ Gửi vị trí thành công!</div>";
                } else {
                  outputArea.innerHTML += "<div>❌ Lỗi khi gửi vị trí.</div>";
                }
              });
            }, (err) => {
              outputArea.innerHTML += `<div>❌ Lỗi: ${err.message}</div>`;
            });
          } else {
            outputArea.innerHTML += "<div>❌ Trình duyệt không hỗ trợ định vị.</div>";
          }
        } else {
          outputArea.innerHTML += "<div>Lệnh không hợp lệ.</div>";
        }
      }
    });
  </script>
</body>
</html>
